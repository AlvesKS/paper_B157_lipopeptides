{"title":"Control efficacy","markdown":{"yaml":{"title":"Control efficacy"},"headingText":"Packages","containsRefs":false,"markdown":"\n\n\n```{r message=FALSE, warning=FALSE}\nlibrary(tidyverse)\nlibrary(gsheet)\nlibrary(ggthemes)\nlibrary(cowplot)\nlibrary(epifitter)\nlibrary(car)\nlibrary(emmeans)\nlibrary(multcomp)\nlibrary(lemon)\nlibrary(patchwork)\n```\n\n```{r}\ntheme_kaique=theme_minimal()+\n  theme(panel.grid = element_blank(),\n        plot.title = element_text(size = 10),\n        axis.ticks = element_line(color = \"gray\"),\n        axis.line = element_line(color = \"gray\"))\n```\n\n# Load Data\n\n```{r}\ndata_load = gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1wxvjxHBWDCUs4kk7TMVptFJDJl0RpKCUrNtRl3Ox7Wk/edit?usp=sharing\") \n```\n\n```{r}\ndata = data_load %>% \n  #removing UCB07 treatment\n  filter(trat != \"UCB07\") %>% \n  # reordering treatments\n  mutate(trat = factor(trat, levels = c(\"Control\", \"B157\", \"Fungicide\"))) \n  \n```\n\nVisualization\n\n```{r}\ndata %>% \n  ggplot(aes(dai, sev, color = as.factor(study)))+\n  geom_point()+\n  facet_wrap(~trat)\n```\n\n## AUDPS - Area under disease progress stairs\n\nHere we calculated the area under disease progress stair (AUDPS) using the function `AUDPS()` from the `epifitter` package.\n\n```{r}\nAUDPS_data = data %>% \n  mutate(dai = dai-7) %>% \n  group_by(trat, study, rep) %>% \n  summarise(audps = AUDPS(time = dai,y = sev))\n\n```\n\n### Visualization\n\nThe comparison of the AUDPS values between treatments\n\n```{r}\nAUDPS_data %>% \n  ggplot(aes(trat, audps))+\n  geom_point()\n```\n\nThe comparison of the transformed ($log(AUDPS+1)$) AUDPS values between treatments.\n\n```{r}\nAUDPS_data %>% \n  ggplot(aes(trat, log(audps+1)))+\n  geom_point()\n```\n\n### Modeling AUDPS\n\n#### Fisrt trial\n\nHere we model the transformed AUDPS using a linear model.\n\n```{r}\nlm_auc1 = lm(log(audps+1)~trat,data= AUDPS_data %>% filter(study ==1))\nsummary(lm_auc1)\n```\n\nTesting the model assumptions\n\n```{r}\nleveneTest(lm_auc1)\nshapiro.test(lm_auc1$residuals)\n```\n\n##### Post-hoc coparisons\n\nWe used the function `cld()` to compare the means obtained from the `emmeans()` function.\n\n```{r}\ncld(\n  emmeans(lm_auc1, ~trat, type = \"response\"),\n  Letters = letters)\n```\n\n#### Second trial\n\nWe repeated the same approach above to the second trial.\n\n```{r}\nlm_auc2 = lm(log(audps+1)~trat,data= AUDPS_data %>% filter(study ==2))\nsummary(lm_auc2)\n```\n\n```{r}\nleveneTest(lm_auc2)\nshapiro.test(lm_auc2$residuals)\n```\n\n```{r}\ncld(\n  emmeans(lm_auc2, ~trat, type = \"response\"),\n  Letters = letters)\n```\n\n# Control efficacy\n\n```{r}\ndataf = data %>% \n  filter(dai == max(dai)) %>% \n  mutate(sev = case_when(sev==0~0.1,\n                         sev!=0~sev),\n         sev = sev/100)\n```\n\n```{r}\ndataf %>% \n  ggplot(aes(trat,log(sev), color = factor(study)))+\n  geom_point(width = 0.1,\n              position = position_jitterdodge(jitter.width = 0.1))+\n  geom_boxplot(fill = NA)\n```\n\n### Firts Trial\n\n```{r}\nlm_f1 = lm(log(sev) ~trat, data = dataf %>% filter(study == 1))\nsummary(lm_f1)\n```\n\n```{r}\ncld(\n  emmeans(lm_f1, ~trat, type = \"response\"),\n  Letters = letters)\n```\n\nCalculating control efficacy\n\n```{r}\nas.data.frame(Confint(lm_f1)) %>% \n  rownames_to_column(var = \"coef\") %>% \n  filter(coef != \"(Intercept)\") %>% \n  separate(coef, into = c(\"trash\", \"trat\"), sep = \"trat\") %>% \n  dplyr::select(-trash) %>% \n  mutate(C = (1-exp(Estimate))*100,\n         C_upper= (1-exp(`2.5 %`))*100,\n          C_lower = (1-exp(`97.5 %`))*100,)\n```\n\n### Second Trial\n\n```{r}\nlm_f2 = lm(log(sev) ~trat, data = dataf %>% filter(study == 2))\nsummary(lm_f2)\n```\n\n```{r}\ncld(\n  emmeans(lm_f2, ~trat, type = \"response\"),\n  Letters = letters)\n```\n\nCalculating control efficacy\n\n```{r}\nas.data.frame(Confint(lm_f2)) %>% \n  rownames_to_column(var = \"coef\") %>% \n  filter(coef != \"(Intercept)\") %>% \n  separate(coef, into = c(\"trash\", \"trat\"), sep = \"trat\") %>% \n  dplyr::select(-trash) %>% \n  mutate(C = (1-exp(Estimate))*100,\n        C_lower = (1-exp(`97.5 %`))*100,\n        C_upper = (1-exp(`2.5 %`))*100)\n```\n\n# Modelos\n\n```{r}\ndata_fitting  = data %>% \n  mutate(sev= sev/100,\n         sev = case_when(sev==0~0.001,\n                         sev!=0~sev),\n         dai = dai-7)\n\n```\n\n```{r}\ndata_fitting_c = data_fitting %>% filter(trat ==\"Control\", study ==2)\n\nfit_nlin2(time =data_fitting_c$dai,\n        y = data_fitting_c$sev)\n```\n\n```{r}\nfit = fit_multi(time_col = \"dai\",\n          intensity_col = \"sev\",\n          data = data_fitting,\n          nlin = T,\n          starting_par = list(y0 = 0.001, r = 0.01, K =  0.5),\n          estimate_K = T,\n          strata_cols = c(\"trat\" , \"study\"))  \n```\n\n```{r}\nfit$Parameters %>% \n  group_by(trat,model,best_model,study) %>% \n  summarise(RSE) %>% \n  arrange(RSE)\n\n```\n\n```{r}\ncurves = fit$Data %>%\n  # full_join(fit$Parameters) %>% \n  filter(model==\"Monomolecular\") %>% \n  mutate(trat = case_when(trat == \"B157\" ~ \"CE\",\n                          trat != \"B157\" ~trat )) %>% \n  mutate(trat = factor(trat, levels = c(\"Control\", \"CE\", \"Fungicide\")),\n         study = case_when(study == 1 ~ \"First trial\",\n                           study == 2 ~ \"Second trial\")) %>% \n  ggplot()+\n  geom_jitter(aes(time+7,y*100, color= trat),\n             alpha = .5,\n             width = 0.1,\n             size = 1.2)+\n  geom_line(aes(time+7, predicted*100, color= trat),\n             size =.8)+\n  facet_rep_wrap(~study)+\n  scale_color_colorblind()+\n  labs(x = \"Days after inoculation\",\n       y = \"Severity (%)\",\n       color = \"\")+\n  scale_x_continuous(breaks = c(7, 9, 11, 13, 15, 17, 20))+\n  theme_kaique\ncurves\n# ggsave(\"figs/curves.png\", dpi = 600, height = 4, width = 6)\n\n # - 7\n\n```\n\n```{r}\ng_r = fit$Parameters %>% \n  filter(model == \"Monomolecular\") %>% \n  mutate(trat = case_when(trat == \"B157\" ~ \"CE\",\n                          trat != \"B157\" ~trat )) %>% \n  mutate(trat = factor(trat, levels = c(\"Control\", \"CE\", \"Fungicide\")),\n         study = case_when(study == 1 ~ \"First trial\",\n                           study == 2 ~ \"Second trial\")) %>% \n  ggplot(aes(trat, r*K, color = study))+\n  geom_point(position = position_dodge(width = 0.2),\n             size = 2)+\n  geom_errorbar(aes(ymin = r_ci_lwr, ymax = r_ci_upr ),\n                width = 0,\n                size =1,\n                position = position_dodge(width = 0.2))+\n  # scale_color_calc()+\n    scale_color_manual(values= c(\"#41ae76\",\"#005824\"))+\n  labs(y = \"Apparent infection rate\",\n       x = \"\",\n       color =\"\")+\n  theme_minimal_hgrid()+\n  theme(legend.position = \"bottom\")\ng_r\n```\n\n```{r}\ng_y0 =fit$Parameters %>% \n  filter(model == \"Monomolecular\") %>% \n  mutate(trat = case_when(trat == \"B157\" ~ \"CE\",\n                          trat != \"B157\" ~trat )) %>%\n   mutate(trat = factor(trat, levels = c(\"Control\", \"CE\", \"Fungicide\")),\n         study = case_when(study == 1 ~ \"First trial\",\n                           study == 2 ~ \"Second trial\")) %>% \n  ggplot(aes(trat, y0*100, color = study))+\n  geom_point(position = position_dodge(width = 0.2),\n             size = 2)+\n  geom_errorbar(aes(ymin=y0_ci_lwr*100,ymax = y0_ci_upr *100),\n                width = 0,\n                size =1,\n                position = position_dodge(width = 0.2))+\n  # scale_color_calc()+\n  scale_color_manual(values= c(\"#41ae76\",\"#005824\"))+\n  labs(y = \"Initial inoculum (%)\",\n       x = \"\",\n       color = \"\")+\n  theme_minimal_hgrid()+\n  theme(legend.position = \"bottom\")\ng_y0\n```\n\n#### Combo parameters\n\n```{r}\ncurves /( g_r + g_y0)+\n  plot_layout(guides = \"collect\",\n              nrow = 2)+\n  plot_annotation(tag_levels = \"A\")&\n  theme_kaique\n  # theme(legend.position = \"bottom\")\nggsave(\".figs/curve_parameters.png\", dpi = 600, height = 5, width = 7, bg = \"white\")\n```\n\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","self-contained":false,"css":["styles.css"],"toc":true,"output-file":"controling_efficacy.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.2.253","theme":{"light":"flatly","dark":"darkly"},"smooth-scroll":true,"title":"Control efficacy"},"extensions":{"book":{"multiFile":true}}}}}