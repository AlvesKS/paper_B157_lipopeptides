{"title":"Well diffusion","markdown":{"yaml":{"title":"Well diffusion"},"headingText":"Packages","containsRefs":false,"markdown":"\n\n\n```{r}\nlibrary(tidyverse)\nlibrary(gsheet)\nlibrary(cowplot)\nlibrary(multcomp)\nlibrary(lme4)\nlibrary(ggthemes)\nlibrary(car)\nlibrary(effects)\nlibrary(emmeans)\nlibrary(afex)  \n```\n\n# Load data\n\n```{r}\ndata1 = gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1qYZ7EfVSn-gL-pV-bBEVU-LCAdDUAz-SToCaHQpZjlE/edit?usp=sharing\") %>% \n  mutate(long = as.numeric(long),\n         trans = as.numeric(trans)) %>% \n  mutate(dai = case_when(aval == 1 ~ 5,\n                         aval == 2 & species==\"microtom\" & trial==1 ~ 10,\n                         aval == 2 & species==\"microtom\" & trial==2 ~ 7,\n                         aval == 2 & species==\"potato\" ~ 7,\n                         aval == 3 ~9,\n                         aval == 4 ~11)) %>% \n  mutate(leasion_size = (trans+long)/2) %>% \n  filter(leasion_size>0) %>% \n  mutate(trat = factor(trat, levels = c(\"CHECK\",\"MEDIUM\",\"CE_MEDIUM\",\"CE_RESIDUE\", \"CE_LPP\")))\n\nhead(data1)\n```\n\n# Visualization\n\n```{r}\ndata1 %>% \n  ggplot(aes(dai,sqrt(leasion_size), color = trat))+\n  geom_point()+\n  geom_smooth(method = \"lm\", se = F, formula = y~poly(x, 1))+\n  facet_grid(species ~trial)\n\n```\n\n```{r}\ndata1 %>% \n  group_by(trial,trat,species) %>% \n  filter(dai == max(dai)) %>% \n  ggplot(aes(trat,leasion_size))+\n  geom_jitter(width = 0.1)+\n  geom_boxplot(fill = NA)+\n  facet_grid(species ~trial)+\n  theme(axis.text.x = element_text(angle = 45,hjust = 1))\n```\n\n# Microtom\n\nSelecting microtom tom data\n\n```{r}\ndata_microtom = data1 %>% \n  filter(species == \"microtom\") %>% \n  mutate(leaflet = as.factor(leaflet),\n         trial = as.factor(trial)) %>% \n  mutate(trat = factor(trat, levels = c(\"CHECK\",\"MEDIUM\",\"CE_MEDIUM\",\"CE_RESIDUE\", \"CE_LPP\")))\n\n\n```\n\n# modeling\n\n## Mix model\n\n```{r}\nmix_microtom = lmer(sqrt(leasion_size) ~ trat*dai + (1|trial/leaflet),\n                    data = data_microtom, REML = F)\nsummary(mix_microtom)\nAIC(mix_microtom)\n```\n\n```{r}\nAnova(mix_microtom)\n```\n\n```{r}\n# em1 = emtrends(mix_microtom,~trat, trend = \"dai\")\n```\n\n## Visualize\n\n```{r}\neff = predictorEffects(mix_microtom, \"trat\", xlevels = 50)\n# eff$trat\nas.data.frame(eff$trat) %>%\n  mutate(trat = factor(trat, levels = c(\"CHECK\",\"MEDIUM\",\"CE_MEDIUM\",\"CE_RESIDUE\", \"CE_LPP\"))) %>% \n  # mutate(fit = exp(fit),\n         # lower = exp(lower),\n         # upper = exp(upper) ) %>% \n  ggplot(aes(dai,fit,color =trat))+\n  geom_point(data =data_microtom, aes(dai,sqrt(leasion_size), group=trat),color = \"gray\")+\n  geom_ribbon(aes(ymin =(lower),ymax = (upper), group = trat),color =NA, alpha = 0.01)+\n  geom_line(size = 1)+\n  scale_color_colorblind()+\n  theme_minimal_hgrid()+\n  labs(x = \"dai\",\n       y = expression(sqrt(\"diameter\")))\n  # facet_wrap(~trat)\n\n```\n\n## Final severity\n\n```{r}\nmicroton_final = data1 %>% \n  filter(species ==\"microtom\") %>% \n  group_by(trial,trat,species) %>% \n  filter(dai == max(dai)) \n\n```\n\n```{r}\nmix_microtom2 = lmer((leasion_size) ~ trat + (1|trial/leaflet),\n                    data = microton_final, REML = F)\nsummary(mix_microtom2)\nAIC(mix_microtom2)\n```\n\n# Well difusion\n\n## Load data\n\n```{r}\nwell_load = gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1rFebMOmrogBPB3JSVTKfDtQIFU_B6pnwseSJPWcLVt4/edit?usp=sharing\")\n```\n\n# Tidy\n\n### Lote 1\n\n```{r}\nwell_data1 = well_load %>% \n  mutate(trat =  factor(trat, levels = c(\"Check\" ,\"CE_Medium\", \"B157\", \"CE_Lpp\",\"Frac1\",\"Frac2\",\"Frac3\",\"Frac4\",\"Frac5\",\"Frac6\",\"Frac7\",\"Frac8\",\"Frac9\",\"Frac10\",\"Frac11\")))%>% \n  filter(lote ==1)\n\n```\n\n## viz\n\n```{r}\nwell_data1  %>% \n  ggplot(aes(trat, raio, color = as.factor(exec), fill =as.factor(exec)))+\n  geom_point(color =\"gray\",\n             size =1,\n             position = position_jitterdodge(jitter.width = .3,\n                                             dodge.width = .5))+\n  stat_summary(fun.data = \"mean_cl_boot\",\n               geom = \"errorbar\",\n               width = 0,\n               size =.5,\n               position = position_dodge(width=.5))+\n  stat_summary(fun = \"mean\",\n               size = 1.4,\n               geom = \"point\",\n               position = position_dodge(width=.5))+\n  facet_wrap(~species)+\n  scale_color_calc()+\n  theme_minimal_hgrid(font_size = 10)+\n  theme(axis.text.x = element_text(angle = 60, hjust = 1),\n        panel.border = element_rect(color = \"gray\"),\n        strip.text = element_text(face = \"italic\"))+\n  labs(x = \"\",\n       y = \"Inhibition zone (radius cm)\",\n       color = \"Trial\",\n       fill = \"Trial\")\n\n\n```\n\n## Modeling\n\n### trial 1\n\n```{r}\nt1_well_data1 = well_data1 %>% \n  filter(exec ==1)\n```\n\n```{r}\nleveneTest(raio ~ trat*species, t1_well_data1)\n```\n\nInhibition zone values equal to zero were converted to 0.001 because the Gamma distribution assumes only positive values\n\n```{r}\nmod1 = glm(raio+0.001 ~ trat*species,family = Gamma, t1_well_data1)\nsummary(mod1)\n# hist(residuals(mod1))\n# shapiro.test(residuals(mod1))\n```\n\n```{r}\nAnova(mod1)\n```\n\n```{r}\ncld(emmeans(mod1, \"trat\", by = \"species\", type= \"response\"), Letters = letters)\nplot\n```\n\n```{r}\n# cld(emmeans(mod1, \"species\", by = \"trat\", type= \"response\"), Letters = letters)\n```\n\n### Trial 2\n\n```{r}\nt2_well_data1 = well_data1 %>% \n  filter(exec ==2)\n```\n\nInhibition zone values equal to zero were converted to 0.001 because the Gamma distribution assumes only positive values\n\n```{r}\nmod2 = glm(raio+0.001 ~ trat*species,family = Gamma, t2_well_data1)\nsummary(mod2)\n\n```\n\n```{r}\nAnova(mod2)\n```\n\n```{r}\ncld(emmeans(mod2, \"trat\", by = \"species\", type= \"response\"), Letters = letters)\n```\n\n```{r}\n\n# cld(emmeans(mod2, \"species\", by = \"trat\"), Letters = letters)\n```\n\n### Lote 2\n\n```{r}\norder = c(\"Check\" ,\"CE_Medium\", \"CP\", \"CE_Lpp\",\"Frac1\",\"Frac2\",\"Frac3\",\"Frac4\",\"Frac5\",\"Frac6\",\"Frac7\",\"Frac8\",\"Frac9\",\"Frac10\",\"Frac11\")\nwell_data2 = well_load %>% \n  mutate(trat =  factor(trat, levels = c(\"Check\" ,\"CE_Medium\", \"B157\", \"CE_Lpp\",\"Frac1\",\"Frac2\",\"Frac3\",\"Frac4\",\"Frac5\",\"Frac6\",\"Frac7\",\"Frac8\",\"Frac9\",\"Frac10\",\"Frac11\")))%>% \n  filter(lote ==2, trat !=\"Frac8\") %>%\n  mutate(trat = as.character(trat),\n         trat = case_when(trat == \"Frac9\" ~ \"Frac8\", trat == \"Frac10\" ~ \"Frac9\",\n                          !trat %in% c(\"Frac9\", \"Frac10\") ~ trat)) %>%\n  mutate(trat =  factor(trat, levels =order ))\n\n```\n\n## viz\n\n```{r}\nwell_data2  %>% \n     ggplot(aes(trat, raio, color = as.factor(exec), fill =as.factor(exec)))+\n  geom_point(color =\"gray\",\n             size =1,\n             position = position_jitterdodge(jitter.width = .3,\n                                             dodge.width = .5))+\n  stat_summary(fun.data = \"mean_cl_boot\",\n               geom = \"errorbar\",\n               width = 0,\n               size =.5,\n               position = position_dodge(width=.5))+\n  stat_summary(fun = \"mean\",\n               size = 1.4,\n               geom = \"point\",\n               position = position_dodge(width=.5))+\n  facet_wrap(~species)+\n  scale_color_calc()+\n  theme_minimal_hgrid(font_size = 10)+\n  theme(axis.text.x = element_text(angle = 60, hjust = 1),\n        panel.border = element_rect(color = \"gray\"),\n        strip.text = element_text(face = \"italic\"))+\n  labs(x = \"\",\n       y = \"Inhibition zone (radius cm)\",\n       color = \"Trial\",\n       fill = \"Trial\")\n\n```\n\n## Modeling\n\n### trial 1\n\n```{r}\nt1_well_data2 = well_data2 %>% \n  filter(exec ==1)\n```\n\n```{r}\nmod1_2 = glm(raio+0.001 ~ trat*species,family = Gamma, t1_well_data2)\nsummary(mod1_2)\n```\n\n```{r}\nboot::glm.diag.plots(mod1_2,boot::glm.diag(mod1_2))\n\n```\n\n```{r}\nAnova(mod1_2)\n```\n\n```{r}\ncld(emmeans(mod1_2, \"trat\", by = \"species\", type= \"response\"), Letters = letters)\nplot\n```\n\n```{r}\n# cld(emmeans(mod1, \"species\", by = \"trat\", type= \"response\"), Letters = letters)\n```\n\n### Trial 2\n\n```{r}\nt2_well_data2 = well_data2 %>% \n  filter(exec ==2)\n```\n\n```{r}\nmod2_2= glm(raio+0.001 ~ trat*species, family = Gamma, t2_well_data2)\nsummary(mod2_2)\n\n```\n\n```{r}\nboot::glm.diag.plots(mod1_2,boot::glm.diag(mod2_2))\n\n```\n\n```{r}\nAnova(mod2_2)\n```\n\n```{r}\ncld(emmeans(mod2_2, \"trat\", by = \"species\", type= \"response\"), Letters = letters)\n```\n\n```{r}\n\n# cld(emmeans(mod2, \"species\", by = \"trat\"), Letters = letters)\n```\n\n```{r}\nall_data_modeled = bind_rows(\nas.data.frame(emmeans(mod1, \"trat\", by = \"species\", type= \"response\")) %>% \n  mutate(lote = \"Second batch\",\n         trial = \"First trial\"),\nas.data.frame(emmeans(mod2, \"trat\", by = \"species\", type= \"response\"))%>% \n  mutate(lote = \"Second batch\",\n         trial = \"Second trial\"),\n\nas.data.frame(emmeans(mod1_2, \"trat\", by = \"species\", type= \"response\")) %>% \n  mutate(lote = \"Third batch\",\n         trial = \"First trial\"),\nas.data.frame(emmeans(mod2_2, \"trat\", by = \"species\", type= \"response\"))%>% \n  mutate(lote = \"Third batch\",\n         trial = \"Second trial\")\n\n\n)\n\n\n```\n\n```{r}\nall_data_modeled %>%\n  filter(lote == \"Second batch\") %>% \n    mutate(trat = as.character(trat),\n         trat = case_when(trat == \"B157\" ~ \"CP\",\n                          trat == \"CE_Medium\" ~ \"CE medium\",\n                          trat == \"Check\"~ \"Control\",\n                          trat == \"CE_Lpp\" ~ \"CE\",\n                          !trat %in% c(\"B157\",\"CE_Medium\", \"Check\", \"CE_Lpp\") ~ trat),\n         species = case_when(species == \"Isolate A3 - A. linariae\" ~ \"A3 - A. linariae\",\n                            species == \"Isolate 248 - A. grandis\" ~ \"As248P - A. linariae\")) %>%\n    mutate(trat =  factor(trat, levels = c(\"Control\" ,\"CE medium\", \"CP\", \"CE\",\"Frac1\",\"Frac2\",\"Frac3\",\"Frac4\",\"Frac5\",\"Frac6\",\"Frac7\",\"Frac8\",\"Frac9\",\"Frac10\",\"Frac11\")))%>% \n   ggplot(aes(trat,response, color = trial))+\n  geom_errorbar(aes(ymin = lower.CL, ymax = upper.CL),\n                position = position_dodge(width = 0.4),\n                width = 0, size =0.5)+\n  geom_point(position = position_dodge(width = 0.4), size = 1.5)+\n  \n  lemon::facet_rep_wrap(~species)+\n  scale_color_manual(values= c(\"#41ae76\",\"#005824\"))+\n  theme_half_open(font_size = 12, line_size = 0.2)+\n  theme(\n        strip.text = element_text(face = \"italic\"),\n        legend.position = \"top\",\n        strip.background = element_blank(),\n        axis.text.x = element_text(angle = 45, hjust = 1)\n        )+\n  labs(x = \"\",\n       y = \"Inhibition zone (cm)\",\n       color =\"\")+\n  background_grid(size.major = 0.2,color.major = \"grey90\")\n  # coord_flip()\nggsave(\".figs/inhib.png\", dpi = 600, height = 3, width = 7, bg = \"white\")\n\n\n```\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","self-contained":false,"css":["styles.css"],"toc":true,"output-file":"well_diffusion.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.2.253","theme":{"light":"flatly","dark":"darkly"},"smooth-scroll":true,"title":"Well diffusion"},"extensions":{"book":{"multiFile":true}}}}}